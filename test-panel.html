<!DOCTYPE html>
<dom-module id="test-panel">
    <style>
        input {
            font-size:11pt;
            width:100%;
        }
        table {
            width:100%;
        }
        td {
            text-align:right;
        }
        ul.links {
            font-size:11pt;
            list-style-type:none;
            text-align:right;
        }
    </style>
    <template>
        <div>
            <input type="text" value="{{filterText::input}}" autofocus placeholder="Search">
            <table>
                <tr><th>Total</th><td>{{stats.total}}</td></tr>
                <tr><th>Coverage</th><td>{{stats.coverage}}</td></tr>
                <tr><th>Pass</th><td>{{stats.pass}}</td></tr>
                <tr><th>Fail</th><td>{{stats.fail}}</td></tr>
            </table>
            <ul class="links">
                <li><a href="http://test.csswg.org/harness/results/css-writing-modes-3_dev/grouped/">Harness Results</a>
                <li><a href="css-writing-modes-3/implementation-report.txt">report.txt</a>
                <li><a href="https://github.com/kojiishi/generate-w3c-implementation-report">github</a>
            </ul>
        </div>
    </template>
    <script>
        function TestStats(total) {
            this.totalCount = total;
            this.count = 0;
            this.passCount = 0;
            this.failCount = 0;
        }
        TestStats.prototype.add = function (test) {
            ++this.count;
            var result = test.Blink;
            if (result) {
                switch (result.result) {
                    case 'pass': ++this.passCount; break;
                    case 'fail': ++this.failCount; break;
                }
            }
        };
        function formatCount(count, total) {
            return count + " (" + Math.round(count * 100 / total) + "%)";
        }
        TestStats.prototype.done = function () {
            if (this.totalCount && this.totalCount != this.count)
                this.total = formatCount(this.count, this.totalCount);
            else
                this.total = this.count;
            this.coverage = formatCount(this.passCount + this.failCount, this.count);
            this.pass = formatCount(this.passCount, this.count);
            this.fail = formatCount(this.failCount, this.count);
        };
        TestStats.create = function (tests, filter) {
            var stats = new TestStats(tests.length);
            if (filter) {
                tests.forEach(function (test) {
                    if (filter(test))
                        stats.add(test);
                });
            } else {
                tests.forEach(function (test) {
                    stats.add(test);
                });
            }
            stats.done();
            return stats;
        };
        Polymer({
            is: 'test-panel',
            properties: {
                filterText: { type: String, notify: true },
            },
            listUpdated: function (tests, filter) {
                this.stats = TestStats.create(tests, filter);
            },
        });
    </script>
</dom-module>
